<app-header></app-header>
<router-outlet></router-outlet>

<div class="detail-bar">
    <div class="infor-detail">
          <button [ngClass]="profileBtn" mat-fab extended (click)="openProfile()">Bệnh án điện tử</button>
          <button [ngClass]="erecordBtn" mat-fab extended (click)="open_schedule()">
            Lịch hẹn
          </button>
    </div>
</div>

<!-- 3 -->
<div class="add-record-screen" *ngIf="initRecordDoctor === false">
  <div class="container" *ngIf="searchResults">
    <div *ngFor="let i of searchResults" class="item">
        <div class="avatar">
            <img src="https://www.shutterstock.com/image-vector/user-profile-icon-vector-avatar-600nw-2247726673.jpg">
        </div>
        <div class="nick-name">
            <button (click) = "selectPetByUserId(i, selectPet)" mat-fab extended>{{i.full_name}}</button>
        </div>
    </div>
  </div>
</div>


<!-- 1 -->
<div class="add-record-screen" *ngIf="initRecordDoctor === true">
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Ngày khám</th>
        <th scope="col">Tên thú cưng</th>
        <th scope="col">Ảnh thú cưng</th>
        <th scope="col">Xem chi tiết</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let i of petRecordByDoctorId" >
          <td>{{ i.examination_date }}</td>
          <td>{{ i.petDto.name }}</td>
          <td><img style="width: 100px;height: 100px" [src]="i.petDto.transfer_contract" alt="Vaccine Image"></td>
          <td>
            <div class="verifySchedule">
              <button mat-fab class="mat-fab" (click)="viewDetailPet(i, viewDetailRecord)">
                <mat-icon>remove_red_eye</mat-icon>
              </button>      
            </div>
          </td>        
      </tr>
    </tbody>
  </table>
</div>

<!-- 4 -->
<div class="add-record-screen" *ngIf="openSchedule && closeRecord && initRecordDoctor">
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Lịch hẹn</th>
        <th scope="col">Người đặt lịch</th>
        <th scope="col">Thông tin</th>
        <th scope="col">Chấp nhận lịch hẹn</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let i of bookingSchedule" >
          <td *ngIf="i.status === 0">{{ i.start }}</td>
          <td *ngIf="i.status === 0">{{ i.customerDto?.customer_name }}</td>
          <td *ngIf="i.status === 0">{{ i.content }}</td>
          <td *ngIf="i.status === 0">
            <div class="verifySchedule">
              <button mat-fab class="mat-fab" (click)="rejectBooking(i.id)">
                Từ chối
              </button>      
              <button mat-fab class="mat-fab" (click)="verifyBooking(i.id)">
                Xác nhận
              </button>
            </div>
          </td>        
      </tr>
    </tbody>
  </table>
</div>

<!-- 2 -->
<div class="add-record-screen" *ngIf="listPetRecordOTP && initRecordDoctor === 1">

  <button mat-fab (click)="openAddPetRecordForm(addPetRecordForm)">
    <mat-icon>add_circle_outline</mat-icon>
  </button>

  <div class="">
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Ngày</th>
          <th scope="col">Tên bác sĩ</th>
          <th scope="col">Triệu chứng</th>
          <th scope="col">Xem chi tiết</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i of getPetRecord">
          <td>{{ i.examination_date }}</td>
          <td>{{ i.doctorDto.user_name }}</td>
          <td>{{ i.symptom_description }}</td>
          <td>
            <button mat-fab class="mat-fab" (click)="viewDetailPetRecord(i, viewDetail)">
              <mat-icon>remove_red_eye</mat-icon>
            </button>      
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
</div>

<ng-template #viewDetail>
  <div>
    <div class="modal-header">
      <b><h1 class="modal-title pull-left">Xem chi tiết bệnh án</h1></b>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <h3>Biểu hiện bệnh</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Triệu chứng mô tả" [(ngModel)]="symptom_descriptionDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Thời gian bị bệnh</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thời gian bị bệnh" [(ngModel)]="symptoms_timeDetail" [disabled]="true"> 
      </div>
      <div class="form-group">
        <h3>Nhiệt độ</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Cơ thể nhiệt độ" [(ngModel)]="body_temperatureDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Kết quả test</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Kết quả test" [(ngModel)]="test_resultsDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Thuốc điều trị</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thuốc" [(ngModel)]="medicationsDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Chế độ dinh dưỡng</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Chế độ dinh dưỡng" [(ngModel)]="nutritionDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Kết quả test lại</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Lịch tái khám" [(ngModel)]="re_examinationDetail" [disabled]="true">
      </div>
    </div>
    <div class="modal-footer">
      <div class="operate-btn">
        <button type="submit" class="btn btn-danger mt-3" (click)="closeDialog()">Đóng</button>
      </div>
    </div>
  </div>
</ng-template>




<ng-template #viewDetailRecord>
  <div>
    <div class="modal-header">
      <b><h1 class="modal-title pull-left">Xem chi tiết bệnh án</h1></b>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <h3>Biểu hiện bệnh</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Triệu chứng mô tả" [(ngModel)]="symptom_descriptionDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Khoảng thời gian bị bệnh</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thời gian bị bệnh" [(ngModel)]="symptoms_timeDetail" [disabled]="true"> 
      </div>
      <div class="form-group">
        <h3>Nhiệt độ cơ thể</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Cơ thể nhiệt độ" [(ngModel)]="body_temperatureDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Kết quả test</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Kết quả test" [(ngModel)]="test_resultsDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Dùng loại thuốc</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thuốc" [(ngModel)]="medicationsDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Chế độ dinh dưỡng</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Chế độ dinh dưỡng" [(ngModel)]="nutritionDetail" [disabled]="true">
      </div>
      <div class="form-group">
        <h3>Lịch tái khám</h3>
        <input autocomplete="off" required class="form-control mt-1" placeholder="Lịch tái khám" [(ngModel)]="re_examinationDetail" [disabled]="true">
      </div>
    </div>
    <div class="modal-footer">
      <div class="operate-btn">
        <button type="submit" class="btn btn-danger mt-3" (click)="closeDialog()">Đóng</button>
      </div>
    </div>
  </div>
</ng-template>



<ng-template #addPetRecordForm>
  <div>
    <div class="modal-header">
      <b><h1 class="modal-title pull-left">Thông tin pet của bạn</h1></b>
    </div>
    <div class="modal-body">
      <h1>1. Thông Tin Chủ Thú Cưng</h1>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Họ và tên chủ nuôi" [(ngModel)]="userName" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Số điện thoại" [(ngModel)]="userPhone" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Địa chỉ" [(ngModel)]="userAddress" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Email" [(ngModel)]="userGmail" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>

      <h1>2. Thông Tin Thú Cưng</h1>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Tên thú cưng" [(ngModel)]="petName" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Tuổi" [(ngModel)]="petAge" [disabled]="true" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Triệu chứng mô tả" [(ngModel)]="symptom_description" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thời gian bị bệnh" [(ngModel)]="symptoms_time" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Cơ thể nhiệt độ" [(ngModel)]="body_temperature" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Kết quả test" [(ngModel)]="test_results" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Sơ bộ-chẩn đoán" [(ngModel)]="external_examinationd" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Thuốc" [(ngModel)]="medications" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Chế độ dinh dưỡng" [(ngModel)]="nutrition" [ngModelOptions]="{standalone: true}">
      </div>
      <div class="form-group">
        <input autocomplete="off" required class="form-control mt-1" placeholder="Lịch tái khám" [(ngModel)]="re_examination" [ngModelOptions]="{standalone: true}">
      </div>
    </div>
    <div class="modal-footer">
      <div class="operate-btn">
        <button type="submit" class="btn btn-danger mt-3" (click)="closeDialog()">Huỷ</button>
        <button type="submit" class="btn btn-primary mt-3" (click)="createPetRecord()">Tạo</button>
      </div>
    </div>
  </div>
</ng-template>



<ng-template #selectPet>
  <div *ngIf="selectPetState">
    <div class="modal-header">
      <b><h1 class="modal-title pull-left">Danh sách pet của bạn</h1></b>
    </div>
    <div class="modal-body">
      <mat-selection-list class="custom-scroll-bar" *ngFor="let i of listPetByUserId" (click)="sendOTP(i)">
        <mat-list-item>
          <img style="height: 45px;width: 45px;border-radius: 50px" [src]="i.transfer_contract"> {{i.name}}
        </mat-list-item>
      </mat-selection-list>
    </div>
  </div>

  <div *ngIf="!selectPetState">
    <div class="modal-header">
      <b><h1 class="modal-title pull-left">Đã gửi mãi OTP về gmail chủ thú cưng</h1></b>
    </div>
    <div class="modal-body">
      <div class="form-group mt-3">
        <h1>Nhập mã</h1>
        <input autocomplete="off" required type="text" class="form-control mt-1" [(ngModel)]="textOTP" >
      </div>
    </div>
    <div class="modal-footer">
      <div class="operate-btn">
        <button type="submit" class="btn btn-danger mt-3" (click)="closeDialog()">Huỷ</button>
        <button type="submit" class="btn btn-primary mt-3" (click)="verifyOTP()">Đồng ý</button>
      </div>
    </div>
  </div>
</ng-template>